<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="WUjeMSeMv1px3dQmbNjIftA-jfJR-TE3bRqRLq3IM0g" />
    <title>HomePage</title>
    <link rel="stylesheet" href="/CSS/navigation.css">
    <link rel="stylesheet" href="/CSS/home-page.css">
    <style>
        .section {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .section h1 {
            font-size: 36px;
            margin-bottom: 15px;
            color: #1c5373;
        }

        .section p {
            font-size: 18px;
            line-height: 1.6;
            color: #444;
        }

        .section img {
            max-width: 100%;
            border-radius: 10px;
            object-fit: cover;
        }

        .section-text {
            flex: 1 1 300px;
        }

        .section-image {
            flex: 1 1 300px;
        }
        
        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .form-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            /* center perfectly */
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            width: 50%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            /* scroll if content too tall */
            z-index: 9999;
            /* puts this elemesnt on top of which ever elements that have less than this elements value.. cool */
            scrollbar-width: none;
        }

        

        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .form-group label {
            /* margin-left: 20%; */
            width: 220px;
            font-weight: bold;
            flex: 1;
            gap: 2px;
        }

        .form-group input,
        .form-group select {
            /* width: 50%; */
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
        }

        button {
            width: 30%;
            padding: 12px;
            background-color: white;
            color: #1c5373;
            border: 2px solid #1c5373;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background-color: #1c5373;
            border: 2px solid #1c5373;
            color: #ffffff;
        }

        .profile {
            display: flex;
            flex-direction: column;
            /* Stack items vertically */
            align-items: stretch;
            /* Stretch inner width */
            width: 400px;
            overflow-y: auto;

            background-color: #ffffff;
            position: fixed;
            top: 80px;
            right: 10px;

            border: 3px solid #ccc;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            display: none;
        }
    </style>
</head>

<body>

    <header class="navbar">
        <img src="/IMAGES/logo_2.png" alt="logo_2" class="logo_2">
        <nav class="nav-links">
            <a href="/pet-products" id="pet-products">Pet Products</a>
            <a href="/adopt" id="adopt">Adopt a Pet</a>
            <a href="/about-developers" id="about-developers">Contact Us</a>
            <a href="/login" id="login">Login</a>
        </nav>
    </header>

    <section class="section">
        <div class="section-text">
            <h1>Our Story</h1>
            <p>Our mission is to find loving homes for pets in need. Every adoption helps give an animal a second
                chance at life, filled with warmth, care, and happiness.</p>
        </div>
        <div class="section-image">
            <img src="/IMAGES/introimage.jpeg" alt="Happy pet and owner">
        </div>
    </section>

    <section class="section">
        <div class="section-text">
            <h1>Why Adopt, Not Shop?</h1>
            <p>By adopting, you're not only giving a pet a loving home but also taking a stand against animal cruelty
                and overbreeding. Make a difference â€” choose adoption.</p>
        </div>
        <div class="section-image">
            <img src="/IMAGES/introimage2.jpeg" alt="Pet adoption scene">
        </div>
    </section>

    <div class="profile" id="profile">
        <form method="post" style="margin: 5%;" id="form">
            <div class="form-group">
                <label for="full_name">Full Name:</label>
                <input type="text" id="full_name" name="full_name" placeholder="Enter full name" disabled>
            </div>

            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" placeholder="Enter email" disabled>
            </div>

            <div class="form-group">
                <label for="address">Address:</label>
                <input type="text" id="address" name="address" placeholder="Enter an address" disabled required>
            </div>

            <div class="form-group">
                <label for="contact_number">Contact Number:</label>
                <input type="tel" id="contact_number" name="contact_number" placeholder="Enter Phone number" disabled
                    required>
            </div>

            <div class="form-group">
                <label for="occupation">Occupation:</label>
                <input type="text" id="occupation" name="occupation" placeholder="Enter jobtitle" disabled required>
            </div>

            <div style="display: flex; gap: 10px; justify-content: center;">
                <button type="button" id="edit">Edit</button>
                <button type="button" id="cancel-profile">Cancel</button>
                <button type="button" id="signout">Signout</button>
            </div>

        </form>
    </div>

    <script>
        const url = window.location.pathname;
        const pathParts = url.split('/');

        var count = 0;
        var userName = 'Guest';
        if (pathParts.length > 2) {
            userName = pathParts[2];
            document.getElementById('pet-products').href += `/${userName}`;
            document.getElementById('adopt').href += `/${userName}`;
            document.getElementById('about-developers').href += `/${userName}`;
            document.getElementById('login').removeAttribute('href'); // removes the link after signing in
            document.getElementById('login').innerHTML = 'Profile';

            fetch(`/profile/${userName}`)
                .then(res => res.json())
                .then(data => {
                    const user = data.user[0];
                    console.log(user);
                    document.getElementById('full_name').value = user.full_name
                    document.getElementById('email').value = user.email;
                    if (user.address)
                        document.getElementById('address').value = user.address;

                    if (user.contact_number)
                        document.getElementById('contact_number').value = user.contact_number;

                    if (user.occupation)
                        document.getElementById('occupation').value = user.occupation;

                }).catch(error => console.log(error));

            // to view the profile
            document.getElementById('login').addEventListener('click', () => {
                count++;
                const profile = document.getElementById('profile');
                profile.style.display = "flex";

                // for closing the profile by clicking on the profile
                if (count > 1) {
                    count = 0;
                    profile.style.display = "none";

                }
            });

            // shows the adoption forms
            const submittedForms = document.getElementById('forms-submitted');

            fetch(`/get-forms/${userName}`)
                .then(res => {
                    if (!res.ok) throw new Error("Failed to fetch forms");
                    return res.json();
                })
                .then(data => {
                    if (!Array.isArray(data) || data.length === 0) {
                        submittedForms.innerHTML += `<p>No adoption forms submitted.</p>`;
                        return;
                    }

                    const ul = document.createElement('ul');
                    data.forEach(form => {
                        const li = document.createElement('li');
                        li.textContent = `${form.pet_name} submitted`;
                        ul.appendChild(li);
                    });

                    submittedForms.appendChild(ul);
                })
                .catch(error => {
                    console.error("Error fetching forms:", error);
                    submittedForms.innerHTML += `<p style="color: red;">Unable to load forms.</p>`;
                });


            var address = document.getElementById('address');
            var contact_number = document.getElementById('contact_number');
            var occupation = document.getElementById('occupation');

            const editBtn = document.getElementById('edit');
            var editCount = 0;

            editBtn.addEventListener("click", async () => {
                editCount++;
                editBtn.textContent = "save"

                address.disabled = false;
                contact_number.disabled = false;
                occupation.disabled = false;

                if (editCount > 1) {
                    editBtn.textContent = "Edit"
                    editCount = 0;

                    address.disabled = true;
                    contact_number.disabled = true;
                    occupation.disabled = true;

                    const updateData = {
                        full_name: userName,
                        address: address.value,
                        contact_number: contact_number.value,
                        occupation: occupation.value
                    };


                    try {
                        const res = await fetch("/update-profile", {
                            method: "PUT",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(updateData)
                        });

                        const result = await res.json();

                        if (res.ok) {
                            alert("Profile updated successfully!");
                        } else {
                            alert("Update failed: " + result.message);
                        }
                    } catch (err) {
                        console.error("Update error:", err);
                        alert("Something went wrong.");
                    }

                }

            });

            document.getElementById('cancel-profile').addEventListener('click', () => {
                address.disabled = true;
                contact_number.disabled = true;
                occupation.disabled = true;
            });


            document.getElementById('signout').addEventListener('click', () => {
                window.location.href = '/';
            });


        }


    </script>

</body>

</html>